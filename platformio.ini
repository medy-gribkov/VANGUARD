; PlatformIO Configuration for VANGUARD
; Target-First Auditing Tool for M5Stack Cardputer
;
; Build: pio run
; Upload: pio run -t upload
; Monitor: pio device monitor

[env:m5stack-cardputer]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

; Cardputer-specific settings (ESP32-S3FN8: 8MB Flash, NO PSRAM)
board_build.mcu = esp32s3
board_build.f_cpu = 240000000L
board_build.flash_mode = qio
board_build.f_flash = 80000000L
board_build.flash_size = 8MB
board_build.partitions = partitions_vanguard.csv
board_upload.flash_size = 8MB

; Upload settings
upload_speed = 1500000
monitor_speed = 115200

; Build flags
build_flags =
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DARDUINO_USB_MODE=1
    -DCORE_DEBUG_LEVEL=1
    -DVANGUARD_VERSION=\"1.0.2\"
    -D CONFIG_BT_NIMBLE_HOST_TASK_STACK_SIZE=8192
    -Wall
    -Os
    -ffunction-sections
    -fdata-sections
    -Wl,--gc-sections

; Static Analysis
check_tool = cppcheck
check_skip_packages = yes
check_flags =
    cppcheck: --suppress=*:*.pio/* --suppress=unusedFunction

; Libraries
lib_deps =
    m5stack/M5Unified @ 0.2.11
    m5stack/M5Cardputer @ 1.1.1
    h2zero/NimBLE-Arduino @ 1.4.1
    https://github.com/me-no-dev/ESPAsyncWebServer.git#ad3741d
    https://github.com/me-no-dev/AsyncTCP.git#ef448a8
    IRremote @ ^4.4.0

[env:native]
platform = native
test_framework = googletest
test_build_src = yes
build_src_filter = -<*> +<core/TargetTable.cpp> +<core/ActionResolver.cpp>
build_flags =
    -std=c++17
    -DUNIT_TEST
    -I test/mocks
    -I test/mocks/core
    -I test/mocks/adapters
    -I test/mocks/ui
    -I src/core
    -I src/ui
lib_deps =
    google/googletest@^1.12.1
